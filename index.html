<html>
  <head>
    <title>Most Popular YouTube Channels and Videos</title>
  </head>
  <script src='https://d3js.org/d3.v5.min.js'></script>
  <script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
  <style> 
    #tooltip{
    opacity:0;
    position: absolute;
    text-align: right;
    width: 60px;
    height 40px;
    background; yellow;
    border: 1px; 
    }
    button {
    text-align: center;
    width: 40px;
    height: 40px;
    cursor: pointer;
    font-size: 16px;
    box-shadow: 2px 2px gray;
    }
    body {
    font-family: Phantomsans, sans-serif;
    width: 55%
    }
  </style>
  <body onload='pickScene(1)'>
    <h1>Most Popular YouTube Channels and Videos</h1>
    <p> 
      More than 17 years after its inception, YouTube has evolved from a virtual space for amateurs to post their cat 
      videos and budget-friendly creations to a space crowded with YouTube celebrities with followings that rival that
      of mainstream media and channels run by media production studios. This interactive slideshow presents a view 
      into YouTube as of July 2022 with a focus on the most popular channels and videos on the site. <br>
      Click the buttons to progress through the slides. <br>
    </p>
    <div id="scene_buttons">
      <button id = "Scene1" onclick="pickScene(1)">1</button>
      <button id = "Scene2" onclick="pickScene(2)">2</button>
      <button id = "Scene3" onclick="pickScene(3)">3</button>
      <button id = "Scene4" onclick="pickScene(4)">4</button>
    </div>
    <div id="svg_div">
      <p id="scene_interaction_tip">Mouse over each bar to see more details.</p>
      <svg width=900 height=730></svg>
    </div>
    <div id="tooltip"></div>
    <div id="scene2_date_slider_div">
      <!-- label is just for white space so it lines up with the date axis  -->
      <label for="date_slider">&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;</label>
      <input type="range" min="1" max="85" value="1" step = "1" id = "date_slider" oninput="init2_remove_draw_lines(this.value)" style="width: 650px;cursor: pointer; ">
    </div>
    <script>
      var scene = 1; 
      
      const chart_margin_top = 5;
      const chart_margin_left = 150;
      const chart_height = 650;
      const chart_width = 650;
      // Because of the date slider for the T-Series vs Pewdiepie scatterplot, init2() is running constantly, so store the constant arrays here
      // so they aren't constantly being reinitialized
      
      const Pewdiepie_Subs_M = [33.3,34.2,35,35.7,36.4,37,37.6,38.5,39,39.6,40.2,40.7,41.4,41.9,42.6,43.1,43.7,44.9,45.9,47,47.7,48.2,49,49.4,51.8,52.9,54,54.5,54.9,55.2,56,56.7,57.2,57.4,57.7,58.1,
      58.9,60.5,61.2,61.9,62.4,63,63.8,64.8,65.8,66.6,69.1,73.5,79.5,83.5,87.6,92.4,95.3,96.3,97,98.5,100.8,101,101.3,101.7,102,102.3,102.7,103,104,104.5,105,105.5,106,106.5,107,107.5,108,108.4,
      108.7,109,109.1,109.3,109.4,109.5,109.6,109.8,109.9,110,110.5,111];
      
      const Tseries_Subs_M = [6.3,6.4,6.6,6.8,6.9,7.1,7.3,7.5,7.7,8,8.3,8.6,8.9,9.2,9.6,9.9,10.3,10.7,11,11.4,11.9,12.4,12.9,13.6,14.5,15.3,16.2,17.4,18.6,19.6,20.8,22.4,23.9,25.5,27.1,28.9,31.3,34.3,
      37.4,40.7,44,47.1,51,55.7,60.1,64.2,68.4,73.1,78.4,83.4,87.6,92.3,96.7,100.5,103.8,107.1,110.6,113.1,116,120.2,123.1,127.1,130.2,134.1,137.1,140.1,144,147.1,151,155,159,163.1,166.4,170.3,174,178.1,
      181,183.3,186,189,191.4,194.1,197.1,200,203,205.9];
      
      const subscribers = [221,139,138,111,99.3,98.4,98.2,89.7,86.1,84,77,75.4,72.7,69.9,69.6,69.5,67.6,65.8,62.9,61,59,57.9,57.4,57.4,55.6,54.6,53.1,52.8,52.6,52.4,52.1,52.1,51.9,51.6,51.3,
      49.5,47.2,46.9,46,46,45.6,45.1,45.1,44.3,43.9,43.8,43.3,43.2,43.1];
      
      const category_colors_object = {"T-Series":"red","Pewdiepie":"Green"};
      
      /*
      const Date = ["2015-01","2015-02","2015-03","2015-04","2015-05","2015-06","2015-07","2015-08","2015-09","2015-10","2015-11","2015-12","2016-01","2016-02","2016-03","2016-04","2016-05","2016-06","2016-07","2016-08","2016-09","2016-10",
      "2016-11","2016-12","2017-01","2017-02","2017-03","2017-04","2017-05","2017-06","2017-07","2017-08","2017-09","2017-10","2017-11","2017-12","2018-01","2018-02","2018-03","2018-04","2018-05","2018-06","2018-07","2018-08","2018-09","2018-10","2018-11","2018-12",
      "2019-01","2019-02","2019-03","2019-04","2019-05","2019-06","2019-07","2019-08","2019-09","2019-10","2019-11","2019-12","2020-01","2020-02","2020-03","2020-04","2020-05","2020-06","2020-07","2020-08","2020-09","2020-10","2020-11","2020-12","2021-01","2021-02",
      "2021-03","2021-04","2021-05","2021-06","2021-07","2021-08","2021-09","2021-10","2021-11","2021-12","2022-01","2022-02"];
      */
      const Date = ["Jan `15", "Feb `15", "Mar `15", "Apr `15","May `15", "Jun `15","Jul `15","Aug `15", "Sep `15","Oct `15", "Nov `15", "Dec `15",
      "Jan `16", "Feb `16", "Mar `16", "Apr `16","May `16", "Jun `16","Jul `16","Aug `16", "Sep `16","Oct `16",  "Nov `16", "Dec `16",
      "Jan `17", "Feb `17", "Mar `17", "Apr `17","May `17", "Jun `17","Jul `17","Aug `17", "Sep `17", "Oct `17", "Nov `17", "Dec `17",
      "Jan `18", "Feb `18", "Mar `18", "Apr `18","May `18", "Jun `18","Jul `18","Aug `18", "Sep `18", "Oct `18", "Nov `18", "Dec `18",
      "Jan `19", "Feb `19", "Mar `19", "Apr `19","May `19", "Jun `19","Jul `19","Aug `19", "Sep `19","Oct `19",  "Nov `19", "Dec `19",
      "Jan `20", "Feb `20", "Mar `20", "Apr `20","May `20", "Jun `20","Jul `20","Aug `20", "Sep `20","Oct `20",  "Nov `20", "Dec `20",
      "Jan `21", "Feb `21", "Mar `21", "Apr `21","May `21", "Jun `21","Jul `21","Aug `21", "Sep `21","Oct `21",  "Nov `21", "Dec `21",
      "Jan `22", "Feb `22"];
      function pickScene(picked){
      
      	scene = picked;
          document.getElementById("Scene1").style.background = "silver";
      	document.getElementById("Scene2").style.background = "silver";
      	document.getElementById("Scene3").style.background = "silver";
      	document.getElementById("Scene4").style.background = "silver";
      	//console.log(document.getElementById("Scene1").style.background);
      	
          // need to clear the svg after click then repopulate
          document.getElementsByTagName("svg")[0].innerHTML = "";
      	if(scene==1){
      	    document.getElementById("Scene1").style.background = "Khaki";
      		document.getElementById("scene_interaction_tip").innerHTML = "Mouse-over each bar to see more details about the top 50 most subscribed channels."
      		document.getElementById("scene2_date_slider_div").hidden = "hidden"; // make the slider and the label hidden from the DOM
      		init1();
      		
      	}
      	if(scene==2){
      		document.getElementById("Scene2").style.background = "Khaki";
      		document.getElementById("scene_interaction_tip").innerHTML = "Use the date slider below the chart to examine the race between two top channels to be the most subscribed channel in the world."
      		document.getElementById("scene2_date_slider_div").removeAttribute("hidden"); // make the slider visible again by removing the hidden attribute
      		init2();
      	}
      	if(scene==3){
      		document.getElementById("Scene3").style.background = "Khaki";
      		document.getElementById("scene_interaction_tip").innerHTML = "Mouse-over each bar to see more details about the most common primary languages among the top 50 most subscribed channels."
      		document.getElementById("scene2_date_slider_div").hidden = "hidden"; // make the slider and the label hidden from the DOM
      		init3();
      	}
      	if(scene==4){
      		document.getElementById("Scene4").style.background = "Khaki";
      		document.getElementById("scene_interaction_tip").innerHTML = "Mouse-over each bar to see more details about how the top 30 most viewed videos further reflect the dominance of music."
      		document.getElementById("scene2_date_slider_div").hidden = "hidden"; // make the slider and the label hidden from the DOM
      		init4();
      	}
      
      }
      // Function for the first chart
      // Horizontal bar chart implementation based on tutorial given here: https://d3-graph-gallery.com/graph/barplot_horizontal.html
      async function init1() {
      
      //const data = await d3.csv('https://github.com/ndarosa2/Visualization_Project/blob/main/prepped_youtube_top_50_most_subscribed_7_21_2022.csv');
      var data = await d3.csv('prepped_youtube_top_50_most_subscribed_7_21_2022.csv');
      //console.log(data);
      //var chart_width = 650;
      
      
      // Make array from 1 to 50 for the ranking 
      var rank = [];
      for (let i = 1; i <= 50; i++) {
              rank.push(i);
      }
      
      // var category_colors_map = new Map(["Music","red"],["Education","black"],["Entertainment","navy"],["Gaming","green"],["Film","olive"],["Sports","purple"],["How-to","gold"],["News Channel","darkorange"],["Comedy","lime"]);
      
      var category_colors_object = {"Music":"red","Education":"black","Entertainment":"navy","Gaming":"green","Film":"olive","Sports":"purple","How-to":"gold","News Channel":"darkorange","Comedy":"lime"};
      //Create the scales
      var x = d3.scaleLinear().domain([0,240]).range([0,chart_width]);
      var y = d3.scaleBand().domain(data.map(function(d) { return d.Channel;})).range([0,chart_height]).padding(0.2);
      
      // Create variable for the tooltip and create mousover and mouseout functions-  implementation based on CS416 lecture video 8-3-2 "D3 Events"
      var tooltip = d3.select("#tooltip");
      
      // Getting an error when style("left"..) of tooltip when try to use d.Subscribers_Millions for calculating px value, so make an array with those values instead
      // var subscribers = [];
      
      var subscribers = [221,139,138,111,99.3,98.4,98.2,89.7,86.1,84,77,75.4,72.7,69.9,69.6,69.5,67.6,65.8,62.9,61,59,57.9,57.4,57.4,55.6,54.6,53.1,52.8,52.6,52.4,52.1,52.1,51.9,51.6,51.3,
      49.5,47.2,46.9,46,46,45.6,45.1,45.1,44.3,43.9,43.8,43.3,43.2,43.1];
      
      
      // Translate the origin and then plot the bar chart
      // The transition is applied to the attributes after its appearance
      
      // save a variable as svg because the transtion method applied to everything after it which makes it so mouseover does not work. 
      // append all the rectangles
      var svg = d3.select("svg").append("g").attr("transform","translate("+chart_margin_left+","+chart_margin_top+")").selectAll("rect").data(data).enter().append("rect");
      
      // set x and y coordinates and width of the rectangles
      svg.attr("x", function(d,i) {return x(0);}).attr("y",function(d,i) {return y(d.Channel);}).attr("height",y.bandwidth()).attr("fill", function(d,i) {return category_colors_object[d.Category];}).attr("stroke","black");
      
      // do a transition for the width of the rectangles so they grow
      svg.transition().duration(4000).delay(300).attr("width", function(d,i) {return x(parseFloat(d.Subscribers_Millions));});
      
      // setup the mouseover and mouseout events
      svg.on("mouseover",function(d,i){
      	tooltip.style("opacity",1)
      		//.style("left",function(d,i) {return String(parseInt(x(parseFloat(d.Subscribers_Millions))))+"px";})
      		.style("left",x(0)+x(subscribers[i])+170+"px") // draw text at where right corner of rect is at plus a buffer of 240 pixels
      		//.style("left",350+"px")
      		.style("top",(d3.event.pageY)+"px")
      		.style("background", "Khaki")
      		.style("width",170)
      		.style("height",60)
      		.style("border","4px")
      		.style(	"text-align", "left")
      		.html("Rank: "+ d.Rank+"<br>" +"Subscribers: "+d.Subscribers_Millions + " M"+"<br>" +"Country: "+d.Country );
      	 //console.log( d3.event.pageY, (d3.event.pageY)+"px", x(subscribers[i])+x(0)+x(subscribers[i])+140+"px");
      	})
      	.on("mouseout", function() { tooltip.style("opacity",0)});
      
      //Create the Y axis
      d3.select("svg")
      .append("g").attr("transform","translate("+chart_margin_left+","+chart_margin_top+")")
      .style("font-size", 12)
      .call(d3.axisLeft(y));
      
      // Create the X axis 
      d3.select("svg")
      .append("g").attr("transform","translate("+chart_margin_left+","+(chart_height+chart_margin_top)+")")
      .style("font-size", 13)
      .call(d3.axisBottom(x).tickFormat(d3.format("~s")));
      
      // Create X axis label. Implementation based on https://bl.ocks.org/d3noob/23e42c8f67210ac6c678db2cd07a747e
        d3.select("svg").append("text")             	
            .attr("transform",
                  "translate(" + (chart_width/2+chart_margin_left) + " ," + 
                                 (chart_height + chart_margin_top + 40) + ")")
            .style("text-anchor", "middle")
            .text("Number of Subscribers (Millions)")
      	  .style("font-size", "1.25em");
      
      // Create Y axis label 
      d3.select("svg").append("text")
      		.attr("transform","translate(" + (chart_margin_left/2-50) + " ," + (chart_height/2 + chart_margin_top+5) + ")rotate(-90)")  
            .style("text-anchor", "middle")
            .text("Channel Name")
      	  .style("font-size", "1.25em");	  
      	  
      // Create the legend - based off of implementation found here: https://d3-graph-gallery.com/graph/custom_legend.html
      
      var category = ["Music","Education","Entertainment","Gaming","Film","Sports","How-to","News Channel","Comedy"];
      var colors = ["red","black","navy","green","olive","purple","gold","darkorange","lime"];
      
      // Add a rectangle in the legend for each category.
      d3.select("svg")
      .append("g").attr("transform","translate("+chart_margin_left+","+chart_margin_top+")")
      .selectAll("rect").data(colors).enter().append("rect")
          .attr("x", 500)
          .attr("y", function(d,i){ return 330 + i*25;}) 
          .attr("width", 20)
          .attr("height",10)
          .attr("fill", function(d,i){ return colors[i];});
      
      // Add some text in the legend for each category.
      d3.select("svg")
      .append("g").attr("transform","translate("+chart_margin_left+","+chart_margin_top+")")
       .selectAll("text").data(category).enter().append("text")
          .attr("x", 530)
          .attr("y", function(d,i){ return 337 + i*25;})
          .text(function(d,i){ return category[i];})
          .attr("text-anchor", "left")
          .style("alignment-baseline", "middle");
      
      // Make some annotations - based off of example found here https://d3-annotation.susielu.com/#introduction
      
      const type = d3.annotationCallout;
      
      const annotations = [{
        note: {
          label: "The Indian music channel T-Series is the most subscribed YouTube channel in the world with over 200 million subscribers.",
          bgPadding: {"top":15,"left":10,"right":10,"bottom":10},
          title: "Most Subscribed Channel",
      	wrap: 200
        },
        type:d3.annotationCallout,
        x:560,
        y:25,
        dy: 100,
        dx: 30,
        color: "red"
      },
      {
        note: {
          label: "The Indian news channel Aaj Talk is the only news channel in a list dominated by music and entertainment.",
          bgPadding: {"top":15,"left":10,"right":10,"bottom":10},
          title: "News Channels in Top 50",
      	wrap: 200
        },
        type:d3.annotationCallout,
        x:300,
        y:375,
        dy: -30,
        dx: 60,
        color: "darkorange",
      },
      {
        note: {
          label: "As of July 2022, 24 out of the top 50 (48%) most subscribed channels are categorized as music.",
          bgPadding: {"top":15,"left":10,"right":10,"bottom":10},
          title: "Most Popular Category",
      	wrap: 200
        },
        type:d3.annotationCallout,
        x:380,
        y:420,
        dy: 0,
        dx: 0,
        color: "red",
      }
      ];
      
      
      const makeAnnotations = d3.annotation().annotations(annotations);
      d3.select("svg").append("g").call(makeAnnotations);
      
      }
      
      
      
      
      function init2() {
      
      const Date_index= [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85];
      //Create the scales
      var x = d3.scaleLinear().domain([0,85]).range([0,chart_width]);
      var y = d3.scaleLinear().domain([0,240]).range([chart_height,0]);
      
      // Translate the origin
      var svg = d3.select("svg").append("g").attr("transform","translate("+chart_margin_left+","+chart_margin_top+")");
      
      
      //Create the Y axis
      d3.select("svg")
      .append("g").attr("transform","translate("+chart_margin_left+","+chart_margin_top+")")
      .style("font-size", 13)
      .call(d3.axisLeft(y));
      
      // Create the X axis 
      chart2_ticks = [0,3,6,9,12,15,18,21,24,27,30,33,36,39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84];
      d3.select("svg")
      .append("g").attr("transform","translate("+chart_margin_left+","+(chart_height+chart_margin_top)+")")
      .style("font-size", 13)
      .call(d3.axisBottom(x).tickValues(chart2_ticks).tickFormat((d, i) => Date[d]))// see tickformat tutorial here https://www.geeksforgeeks.org/d3-js-axis-tickformat-function/
      .selectAll("text")
      .attr("transform", "translate(-20,20)rotate(-65)") // rotating and translate axis tutorial found here https://d3-graph-gallery.com/graph/custom_axis.html
      ; 
      
      // Create X axis label. Implementation based on https://bl.ocks.org/d3noob/23e42c8f67210ac6c678db2cd07a747e
        d3.select("svg").append("text")             	
            .attr("transform",
                  "translate(" + (chart_width/2+chart_margin_left) + " ," + 
                                 (chart_height + chart_margin_top + 70) + ")")
            .style("text-anchor", "middle")
            .text("Date")
      	  .style("font-size", "1.25em");	
      
      // Create Y axis label 
      d3.select("svg").append("text")
      		.attr("transform","translate(" + (chart_margin_left/2-10) + " ," + (chart_height/2 + chart_margin_top) + ")rotate(-90)")  
            .style("text-anchor", "middle")
            .text("Number of Subscribers (Millions)")
      	  .style("font-size", "1.25em");	
      
      
      // Create the legend - based off of implementation found here: https://d3-graph-gallery.com/graph/custom_legend.html
      var category = ["T-Series","Pewdiepie"];
      var colors = ["red","green"];
      
      // Add a circle in the legend for each category.
      d3.select("svg")
      .append("g").attr("transform","translate("+chart_margin_left+","+chart_margin_top+")")
      .selectAll("circle").data(colors).enter().append("circle")
          .attr("cx", 500)
          .attr("cy", function(d,i){ return 450 + i*25;}) 
          .attr("r", 10)
          .attr("fill", function(d,i){ return colors[i];});
      
      // Add some text in the legend for each category.
      d3.select("svg")
      .append("g").attr("transform","translate("+chart_margin_left+","+chart_margin_top+")")
       .selectAll("text").data(category).enter().append("text")
          .attr("x", 520)
          .attr("y", function(d,i){ return 453 + i*25;})
          .text(function(d,i){ return category[i];})
          .attr("text-anchor", "left")
          .style("alignment-baseline", "middle");
      
      // Make some annotations - based off of example found here https://d3-annotation.susielu.com/#introduction
      
      const type = d3.annotationCallout;
      
      const annotations = [{
        note: {
          label: "T-Series permanently overtook Pewdiepie on April 15, 2019 after previously overtaking Pewdiepie for only a few days from March 27 to March 31, 2019. A month later T-Series became the first channel to reach 100 million subscribers on May 28th, 2019. Pewdiepie soon exited from the competition.",
          bgPadding: {"top":15,"left":10,"right":10,"bottom":10},
          title: "New Top Channel",
      	wrap: 300
        },
        type:d3.annotationCallout,
        x:535,
        y:400,
        dy: -70,
        dx: -60,
        color: "red"
      },
      {
        note: {
          label: "T-Series reached the 200 million subscriber milestone on Dec 1, 2021.",
          bgPadding: {"top":15,"left":10,"right":10,"bottom":10},
          title: "200 Million Milestone",
      	wrap: 200
        },
        type:d3.annotationCallout,
        x:780,
        y:110,
        dy: -10,
        dx: -30,
        color: "red"
      },
      {
        note: {
          label: "From August 15, 2013 to March 26, 2019 (2050 days) Pewdiepie was the most subscribed YouTube channel. This 2050 day streak has not yet been broken.",
          bgPadding: {"top":15,"left":10,"right":10,"bottom":10},
          title: "Longest Top Channel Streak",
      	wrap: 300
        },
        type:d3.annotationCallout,
        x:180,
        y:380,
        dy: 0,
        dx: 0,
        color: "green"
      },
      {
        note: {
          label: "In late 2018, Indian music channel T-Series and Swedish gaming personality Pewdiepie competed to be the most subscribed YouTube channel in the world. The fanbases of each channel campaigned heavily online.",
          bgPadding: {"top":15,"left":10,"right":10,"bottom":10},
          title: "Race to 100 million",
      	wrap: 300
        },
        type:d3.annotationCallout,
        x:180,
        y:10,
        dy: 0,
        dx: 0,
        color: "black"
      }
      ];
      
      
      const makeAnnotations = d3.annotation().annotations(annotations);
      d3.select("svg").append("g").call(makeAnnotations);
      
      }
      
      
      // Function to remove the current paths in the Tseries vs Pewdiepie scatterplot, and then redraw them only up to the specified date
      // This is done for efficiency. The init2 function does all of the drawing of axis, legend etc, annotations, but then this function takes care of drawing only the lines
      // This way the annotations, axis, legend, etc aren't constantly redrawing over themselves.  
      function init2_remove_draw_lines(max_date){
      
      // oninput of the date range slider, remove all the path elements in the svg that have class name line_chart_class. 
      d3.select("svg").selectAll(".line_chart_class").remove();
      
      // select text that have the class .date_subscribers_text and remove them. Make it class specific because dont want to accidentally 
      // remove other elements  
      d3.select("svg").selectAll(".date_subscribers_text").remove();
      
      var max_date_index = max_date; 
      var Date_index = [];
      for (let i = 0; i <= max_date_index; i++) {
              Date_index.push(i);
      }
      
      //Create the scales
      var x = d3.scaleLinear().domain([0,85]).range([0,chart_width]);
      var y = d3.scaleLinear().domain([0,240]).range([chart_height,0]);
      
      // save a variable as svg  
      var svg = d3.select("svg").append("g").attr("transform","translate("+chart_margin_left+","+chart_margin_top+")");
      
      
      // For Pewdiepie Add the lines between the points. Example taken from https://d3-graph-gallery.com/graph/line_basic.html
      // specify the class to be a line_chart_class (arbitrary name), so when remove paths in init2_remove_draw_lines(), can choose to only remove paths that are part of line_chart_class
      d3.select("svg").append("g").attr("transform","translate("+chart_margin_left+","+chart_margin_top+")").append("path").datum(Date_index).attr("fill", "none").attr("stroke", "green").attr("stroke-width",2).attr("class","line_chart_class")
      		.attr("d", d3.line()
      		.x(function(d,i) { return x(d) })
              .y(function(d,i) { return y(Pewdiepie_Subs_M[i]) })
              );
      
      // For T-Series Add the lines between the points. Example taken from https://d3-graph-gallery.com/graph/line_basic.html
      d3.select("svg").append("g").attr("transform","translate("+chart_margin_left+","+chart_margin_top+")").append("path").datum(Date_index).attr("fill", "none").attr("stroke", "red").attr("stroke-width",2).attr("class","line_chart_class")
      		.attr("d", d3.line()
              .x(function(d,i) { return x(d) })
              .y(function(d,i) { return y(Tseries_Subs_M[i]) })
              );
      
      svg.append("text")
          .attr("x", 410)
          .attr("y", chart_height / 2 +210)
      	.attr("fill", "black")
      	.attr("class","date_subscribers_text")
          .attr("font-weight","bold") 
          .attr("font-size",20)
          .text(function(d,i) { return "Date: "+ Date[max_date_index]; });
      svg.append("text")
          .attr("x", 410)
          .attr("y", chart_height / 2 +230)
      	.attr("fill", "red")
      	.attr("class","date_subscribers_text")
      	.attr("font-weight","bold") 
      	.attr("font-size",20)
          .text(function(d,i) { return "T-Series: "+ Tseries_Subs_M[max_date_index] + " Million"; });
      
      svg.append("text")
          .attr("x", 410)
          .attr("y", chart_height / 2 +250)
      	.attr("fill", "green")
      	.attr("class","date_subscribers_text")
          .attr("font-weight","bold") 
      	.attr("font-size",20)
          .text(function(d,i) { return "Pewdiepie: "+ Pewdiepie_Subs_M[max_date_index] + " Million"; });
      }
      
      
      
      
      // Function for the third chart
      // Horizontal bar chart implementation based on tutorial given here: https://d3-graph-gallery.com/graph/barplot_horizontal.html
      async function init3() {
      
      var data = await d3.csv('prepped_youtube_top_50_most_subscribed_7_21_2022.csv');
      console.log(data)
      // Make array from 1 to 50 for the ranking 
      var rank = [];
      for (let i = 1; i <= 50; i++) {
              rank.push(i);
      }
      
      var language_colors_object = {"English":"MediumSeaGreen","Hindi":"orange","Spanish":"red","Portuguese":"PeachPuff","Korean":"DodgerBlue","Bhojpuri":"gray"};
      var language = ["English","Hindi","Spanish","Portuguese","Korean","Bhojpuri"]; 
      var data = [22,15,5,4,3,1]; //language count;
      //Create the scales
      var x = d3.scaleLinear().domain([0,25]).range([0,chart_width]);
      var y = d3.scaleBand().domain(language).range([0,chart_height]).padding(0.2);
      
      // Create variable for the tooltip and create mousover and mouseout functions-  implementation based on CS416 lecture video 8-3-2 "D3 Events"
      var tooltip = d3.select("#tooltip");
      
      // Getting an error when style("left"..) of tooltip when try to use d.Subscribers_Millions for calculating px value, so make an array with those values instead
      // var subscribers = [];
      
      var subscribers = [221,139,138,111,99.3,98.4,98.2,89.7,86.1,84,77,75.4,72.7,69.9,69.6,69.5,67.6,65.8,62.9,61,59,57.9,57.4,57.4,55.6,54.6,53.1,52.8,52.6,52.4,52.1,52.1,51.9,51.6,51.3,
      49.5,47.2,46.9,46,46,45.6,45.1,45.1,44.3,43.9,43.8,43.3,43.2,43.1];
      
      
      // Translate the origin and then plot the bar chart
      // The transition is applied to the attributes after its appearance
      
      // save a variable as svg because the transtion method applied to everything after it which makes it so mouseover does not work. 
      // append all the rectangles
      var svg = d3.select("svg").append("g").attr("transform","translate("+chart_margin_left+","+chart_margin_top+")").selectAll("rect").data(data).enter().append("rect");
      
      // set x and y coordinates and width of the rectangles
      svg.attr("x", function(d,i) {return x(0);}).attr("y",function(d,i) {return y(language[i]);}).attr("height",y.bandwidth()).attr("fill", function(d,i) {return language_colors_object[language[i]];}).attr("stroke","black");
      
      // do a transition for the width of the rectangles so they grow
      svg.transition().duration(4000).delay(300).attr("width", function(d,i) {return x(d);});
      
      // setup the mouseover and mouseout events - based on example given in lecture
      svg.on("mouseover",function(d,i){
      	tooltip.style("opacity",1)
      		//.style("left",function(d,i) {return String(x(d))+"px";})
      		.style("left",x(0)+x(d)+170+"px") // draw text at where right corner of rect is at plus a buffer of 170 pixels
      		//.style("left",350+"px")
      		.style("top",(d3.event.pageY)+"px")
      		.style("background", "Khaki")
      		.style("width",120)
      		.style("height",60)
      		.style("border","4px")
      		.style(	"text-align", "left")
      		.html("Count: "+ d+"<br>" +"% of Top 50: "+(d/50*100) + "%");
      	 console.log( d3.event.pageY, (d3.event.pageY)+"px");
      	})
      	.on("mouseout", function() { tooltip.style("opacity",0)});
      
      
      //Create the Y axis
      d3.select("svg")
      .append("g").attr("transform","translate("+chart_margin_left+","+chart_margin_top+")")
      .style("font-size", 12)
      .call(d3.axisLeft(y));
      
      // Create the X axis 
      d3.select("svg")
      .append("g").attr("transform","translate("+chart_margin_left+","+(chart_height+chart_margin_top)+")")
      .style("font-size", 13)
      .call(d3.axisBottom(x).tickFormat(d3.format("~s")));
      
      // Create X axis label. Implementation based on https://bl.ocks.org/d3noob/23e42c8f67210ac6c678db2cd07a747e
        d3.select("svg").append("text")             	
            .attr("transform",
                  "translate(" + (chart_width/2+chart_margin_left) + " ," + 
                                 (chart_height + chart_margin_top + 40) + ")")
            .style("text-anchor", "middle")
            .text("Count of Channels in Top 50")	  
      	  .style("font-size", "1.25em");
      
      // Creat Y axis label
      d3.select("svg").append("text")
        .attr("transform","translate(" + (chart_margin_left/2-10) + " ," + (chart_height/2 + chart_margin_top) + ")rotate(-90)")
            .style("text-anchor", "middle")
            .text("Primary Language")
      	  .style("font-size", "1.25em");  
      
      // Create the legend - based off of implementation found here: https://d3-graph-gallery.com/graph/custom_legend.html
      
      var category = ["Music","Education","Entertainment","Gaming","Film","Sports","How-to","News Channel","Comedy"];
      var colors= ["MediumSeaGreen","orange","red","PeachPuff","DodgerBlue","gray"];
      var language = ["English","Hindi","Spanish","Portuguese","Korean","Bhojpuri"]; 
      
      // Add a rectangle in the legend for each category.
      d3.select("svg")
      .append("g").attr("transform","translate("+chart_margin_left+","+chart_margin_top+")")
      .selectAll("rect").data(colors).enter().append("rect")
          .attr("x", 500)
          .attr("y", function(d,i){ return 330 + i*25;}) 
          .attr("width", 20)
          .attr("height",10)
          .attr("fill", function(d,i){ return d;});
      
      // Add some text in the legend for each language.
      d3.select("svg")
      .append("g").attr("transform","translate("+chart_margin_left+","+chart_margin_top+")")
       .selectAll("text").data(language).enter().append("text")
          .attr("x", 530)
          .attr("y", function(d,i){ return 337 + i*25;})
          .text(function(d,i){ return d;})
          .attr("text-anchor", "left")
          .style("alignment-baseline", "middle")
      
      // Make some annotations - based off of example found here https://d3-annotation.susielu.com/#introduction
      
      const type = d3.annotationCallout;
      
      const annotations = [{
        note: {
          label: "English and Hindi, the first and third most spoken languages in the world, dominate the list with 74% of the top 50 channels speaking primarily in English or Hindi.",
          bgPadding: {"top":15,"left":10,"right":10,"bottom":10},
          title: "English and Hindi Dominate",
      	wrap: 250
        },
        type:d3.annotationCallout,
        x:350,
        y:290,
        dy: 0,
        dx: 0,
        color: "black"
      },
      {
        note: {
          label: "English is the most common top channel primary language with 44% of the top 50 channels speaking primarily in English.",
          bgPadding: {"top":15,"left":10,"right":10,"bottom":10},
          title: "Most Common Primary Language",
      	wrap: 250
        },
        type:d3.annotationCallout,
        x:580,
        y:110,
        dy: 50,
        dx: 10,
        color: "MediumSeaGreen"
      },
      {
        note: {
          label: "Chinese languages, such as Mandarin (language with the second most speakers in the world), are likely missing from the list because YouTube is blocked in mainland China and because of the presence of YouTube competitors such as YouKu.",
          bgPadding: {"top":15,"left":10,"right":10,"bottom":10},
          title: "Absence of Chinese Languages",
          wrap: 250
        },
        type:d3.annotationCallout,
        x:350,
        y:450,
        dy: 0,
        dx: 0,
      
        color: "black"
      }
      
      ];
      
      
      const makeAnnotations = d3.annotation().annotations(annotations);
      d3.select("svg").append("g").call(makeAnnotations)   ;
      
      }
      
      
      
      // Function for the fourth chart
      // Horizontal bar chart implementation based on tutorial given here: https://d3-graph-gallery.com/graph/barplot_horizontal.html
      async function init4() {
      
      var data = await d3.csv('most_viewed_youtube_videos_7_28_2022.csv');
      
      // Make array from 1 to 30 for the ranking 
      var rank = [];
      for (let i = 1; i <= 30; i++) {
              rank.push(i);
      }
      
      var category_colors_object = {"Music":"red","Other":"black"};
      
      //Create the scales
      var x = d3.scaleLinear().domain([0,11.1]).range([0,chart_width]);
      var y = d3.scaleBand().domain(data.map(function(d) { return d.Video_name;})).range([0,chart_height]).padding(0.2);
      
      // Create variable for the tooltip and create mousover and mouseout functions- implementation based on CS416 lecture video 8-3-2 "D3 Events"
      var tooltip = d3.select("#tooltip");
      
      // Getting an error when style("left"..) of tooltip when try to use d.Views_B for calculating px value, so make an array with those values instead
      
      var views = [11.02,7.92,6.4,5.77,5.58,5.53,4.75,4.64,4.6,4.5,4.49,4.24,4,3.73,3.62,3.61,3.57,3.48,3.44,3.32,3.31,3.31,3.31,3.27,3.24,3.24,3.21,3.2,3.19,3.11];
      
      // Translate the origin and then plot the bar chart
      // The transition is applied to the attributes after its appearance
      
      // save a variable as svg because the transtion method applied to everything after it which makes it so mouseover does not work. 
      // append all the rectangles
      var svg = d3.select("svg").append("g").attr("transform","translate("+chart_margin_left+","+chart_margin_top+")").selectAll("rect").data(data).enter().append("rect");
      
      // set x and y coordinates and width of the rectangles
      svg.attr("x", function(d,i) {return x(0);}).attr("y",function(d,i) {return y(d.Video_name);}).attr("height",y.bandwidth()).attr("fill", function(d,i) {return category_colors_object[d.Category];}).attr("stroke","black");
      
      // do a transition for the width of the rectangles so they grow
      svg.transition().duration(4000).delay(300).attr("width", function(d,i) {return x(parseFloat(d.Views_B));});
      
      // setup the mouseover and mouseout events - based on tutorial given in lecture
      svg.on("mouseover",function(d,i){
      	tooltip.style("opacity",1)
      		.style("left",x(0)+x(views[i])+170+"px") // draw text at where right corner of rect is at plus a buffer of 170 pixels
      		.style("top",(d3.event.pageY)+"px")
      		.style("background", "Khaki")
      		.style("width",160)
      		.style("height",80)
      		.style("border","4px")
      		.style(	"text-align", "left")
      		.html("Rank: "+ d.Rank+"<br>" +"Views: "+d.Views_B + " B"+"<br>" +"Channel: "+d.Channel);
      	})
      	.on("mouseout", function() { tooltip.style("opacity",0)});
      
      //Create the Y axis
      d3.select("svg")
      .append("g").attr("transform","translate("+chart_margin_left+","+chart_margin_top+")")
      .style("font-size", 10.5)
      .call(d3.axisLeft(y));
      
      // Create the X axis 
      d3.select("svg")
      .append("g").attr("transform","translate("+chart_margin_left+","+(chart_height+chart_margin_top)+")")
      .style("font-size", 13)
      .call(d3.axisBottom(x).tickFormat(d3.format("~s")));
      
      // Create X axis label. Implementation based on https://bl.ocks.org/d3noob/23e42c8f67210ac6c678db2cd07a747e
        d3.select("svg").append("text")             	
            .attr("transform",
                  "translate(" + (chart_width/2+chart_margin_left) + " ," + 
                                 (chart_height + chart_margin_top + 40) + ")")
            .style("text-anchor", "middle")
            .text("Views (Billions)")
      	  .style("font-size", "1.25em");
      
      // Create Y axis label 
      d3.select("svg").append("text")
      		.attr("transform","translate(" + (chart_margin_left/2-50) + " ," + (chart_height/2 + chart_margin_top+5) + ")rotate(-90)")  
            .style("text-anchor", "middle")
            .text("Video Title")
      	  .style("font-size", "1.25em");	  
      	  
      // Create the legend - based off of implementation found here: https://d3-graph-gallery.com/graph/custom_legend.html
      
      var category = ["Music","Other"];
      var colors = ["red","black"];
      
      // Add a rectangle in the legend for each category.
      d3.select("svg")
      .append("g").attr("transform","translate("+chart_margin_left+","+chart_margin_top+")")
      .selectAll("rect").data(colors).enter().append("rect")
          .attr("x", 500)
          .attr("y", function(d,i){ return 330 + i*25;}) 
          .attr("width", 20)
          .attr("height",10)
          .attr("fill", function(d,i){ return colors[i];});
      
      // Add some text in the legend for each category.
      d3.select("svg")
      .append("g").attr("transform","translate("+chart_margin_left+","+chart_margin_top+")")
       .selectAll("text").data(category).enter().append("text")
          .attr("x", 530)
          .attr("y", function(d,i){ return 337 + i*25;})
          .text(function(d,i){ return category[i];})
          .attr("text-anchor", "left")
          .style("alignment-baseline", "middle");
      
      // Make some annotations - based off of example found here https://d3-annotation.susielu.com/#introduction
      
      const type = d3.annotationCallout;
      
      const annotations = [{
        note: {
          label: "The English children`s song Baby Shark Dance is the most viewed YouTube video in the world with over 11 billion views.",
          bgPadding: {"top":15,"left":10,"right":10,"bottom":10},
          title: "Most Viewed Video",
      	wrap: 200
        },
        type:d3.annotationCallout,
        x:630,
        y:25,
        dy: 100,
        dx: 5,
        color: "red"
      },
      {
        note: {
          label: "Recipe for Disaster, an episode of the Russian children`s show Masha and the Bear, is the only non-music video in the list.",
          bgPadding: {"top":15,"left":10,"right":10,"bottom":10},
          title: "Only Non-Music Video in Top 30",
      	wrap: 200
        },
        type:d3.annotationCallout,
        x:430,
        y:205,
        dy: 60,
        dx: 10,
        color: "black",
      },
      {
        note: {
          label: "Music dominates the most viewed YouTube video list even more than it does the most subscribed YouTube channels list. As of July 2022, 29 out of the top 30 (97%) of the most viewed YouTube videos are music videos.",
          bgPadding: {"top":15,"left":10,"right":10,"bottom":10},
          title: "Most Popular Category",
      	wrap: 200
        },
        type:d3.annotationCallout,
        x:500,
        y:440,
        dy: 0,
        dx: 0,
        color: "red",
      }
      ];
      
      
      const makeAnnotations = d3.annotation().annotations(annotations);
      d3.select("svg").append("g").call(makeAnnotations);
      
      }
      
      
      
      
    </script>
  </body>
</html>